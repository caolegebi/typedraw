var TD=TD||{};TD.donors=[],TD.lucks=[],function(){"use strict";var e=document,t=e.getElementsByTagName("body")[0];t.addEventListener("touchstart",function(){})}(),function(){"use strict";var e=document,t="24 October 2016 00:00 UTC+8",n="csv/donors.csv",r={method:"GET",mode:"cors"},s={header:!0},a=Date.now(),o=new Chance(a),c=function(e){for(var t=[],n=0;n<e.length;n++)"ind"===e[n].type&&"0"===e[n].flag&&t.push(e[n]);return t},i=function(e,t){for(var n,r=0;r<t;r++)n=o.integer({min:0,max:e.length-(1+r)}),TD.lucks.push(e[n]),e.splice(n,1)},d=function(){var t=c(TD.donors),n=e.querySelector("#rnd-num"),r=n.value;i(t,r),l(),u()},l=function(){var t=e.querySelector(".machine");t.classList.add("is-hidden")},u=function(){var t=e.querySelector(".announce"),n=e.getElementById("tmpl-result").text,r=doT.template(n),s=r(TD.lucks);t.innerHTML=s,t.classList.add("is-show")};fetch(n,r).then(function(e){if(e.ok)return e.text();var t=new Error(e.statusText);throw t.res=e,t}).then(function(n){TD.donors=Papa.parse(n,s).data;var r=e.querySelector(".ack-time"),a=e.querySelector(".ack-num"),o=e.querySelector(".ack");r.textContent=t,a.textContent=TD.donors.length,o.classList.remove("is-disabled");var c=e.querySelector("#draw-btn");c.classList.remove("is-disabled"),c.addEventListener("click",d)})}(),function(){"use strict";var e=document,t=e.querySelector(".modal"),n=function(n,a,o,c){var i=e.getElementsByClassName(n)[0],d=e.getElementById(a).text,l=doT.template(d),u=l(o);i.innerHTML=u,setTimeout(r,50),t.addEventListener("click",function(e){for(var t=e.target;t&&!t.matches("#"+c+",."+n);)t=t.parentNode;t&&t.matches("#"+c)&&s()})},r=function(){t.classList.add("is-active")},s=function(){t.classList.remove("is-active")},a=e.getElementById("action-donors"),o=function(){n("modal-main","tmpl-donors",TD.donors,"modal-close")};a.addEventListener("click",o)}(),function(){"use strict";var e=document,t=e.querySelector("#rnd-num"),n=e.querySelector("#rnd-dec"),r=e.querySelector("#rnd-inc"),s=function(){var e=t.value;return e<=1?void n.classList.add("is-disabled"):(e--,t.value=e,n.classList.remove("is-disabled"),void(e<=1&&n.classList.add("is-disabled")))},a=function(){var e=t.value;e++,t.value=e,e>1&&n.classList.remove("is-disabled")};n.addEventListener("click",s),r.addEventListener("click",a)}();